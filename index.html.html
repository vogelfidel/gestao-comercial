<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Gest√£o Comercial">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#21808d">
    <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIlNpc3RlbWEgZGUgR2VzdMOjbyBDb21lcmNpYWwiLAogICJzaG9ydF9uYW1lIjogIkdlc3TDo28iLAogICJzdGFydF91cmwiOiAiLiIsCiAgImRpc3BsYXkiOiAic3RhbmRhbG9uZSIsCiAgImJhY2tncm91bmRfY29sb3IiOiAiI2ZjZmNmOSIsCiAgInRoZW1lX2NvbG9yIjogIiMyMTgwOGQiLAogICJpY29ucyI6IFsKICAgIHsKICAgICAgInNyYyI6ICJkYXRhOmltYWdlL3N2Zyt4bWwsJTNDc3ZnJTIweG1sbnMlM0QnaHR0cCUzQSUyRiUyRnd3dy53My5vcmclMkYyMDAwJTJGc3ZnJyUyMHdpZHRoJTNEJzE5MiclMjBoZWlnaHQlM0QnMTkyJyUzRSUzQ3JlY3QlMjBmaWxsJTNEJyUyMzIxODA4ZCclMjB3aWR0aCUzRCcxOTInJTIwaGVpZ2h0JTNEJzE5MiclMjByeCUzRCczMCclMkYlM0UlM0N0ZXh0JTIweCUzRCc1MCUyNSclMjB5JTNEJzUwJTI1JyUyMGZvbnQtc2l6ZSUzRCc4MCclMjBmaWxsJTNEJyUyM2ZmZiclMjB0ZXh0LWFuY2hvciUzRCdtaWRkbGUnJTIwZG9taW5hbnQtYmFzZWxpbmUlM0QnbWlkZGxlJyUzRSVGMCU5RiU5MyVCMSUzQyUyRnRleHQlM0UlM0MlMkZzdmclM0UiLAogICAgICAic2l6ZXMiOiAiMTkyeDE5MiIsCiAgICAgICJ0eXBlIjogImltYWdlL3N2Zyt4bWwiCiAgICB9CiAgXQp9">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='32' height='32'%3E%3Crect fill='%2321808d' width='32' height='32' rx='6'/%3E%3Ctext x='50%25' y='50%25' font-size='20' fill='%23fff' text-anchor='middle' dominant-baseline='middle'%3Eüì±%3C/text%3E%3C/svg%3E">
    <title>Sistema Gest√£o Comercial</title>
    <style>
        :root {
            --color-white: rgba(255, 255, 255, 1);
            --color-black: rgba(0, 0, 0, 1);
            --color-cream-50: rgba(252, 252, 249, 1);
            --color-cream-100: rgba(255, 255, 253, 1);
            --color-gray-200: rgba(245, 245, 245, 1);
            --color-gray-300: rgba(167, 169, 169, 1);
            --color-gray-400: rgba(119, 124, 124, 1);
            --color-slate-500: rgba(98, 108, 113, 1);
            --color-brown-600: rgba(94, 82, 64, 1);
            --color-charcoal-700: rgba(31, 33, 33, 1);
            --color-charcoal-800: rgba(38, 40, 40, 1);
            --color-slate-900: rgba(19, 52, 59, 1);
            --color-teal-300: rgba(50, 184, 198, 1);
            --color-teal-400: rgba(45, 166, 178, 1);
            --color-teal-500: rgba(33, 128, 141, 1);
            --color-teal-600: rgba(29, 116, 128, 1);
            --color-teal-700: rgba(26, 104, 115, 1);
            --color-red-400: rgba(255, 84, 89, 1);
            --color-red-500: rgba(192, 21, 47, 1);
            --color-orange-400: rgba(230, 129, 97, 1);
            --color-orange-500: rgba(168, 75, 47, 1);
            
            --color-brown-600-rgb: 94, 82, 64;
            --color-teal-500-rgb: 33, 128, 141;
            --color-slate-900-rgb: 19, 52, 59;
            
            --color-background: var(--color-cream-50);
            --color-surface: var(--color-cream-100);
            --color-text: var(--color-slate-900);
            --color-text-secondary: var(--color-slate-500);
            --color-primary: var(--color-teal-500);
            --color-primary-hover: var(--color-teal-600);
            --color-primary-active: var(--color-teal-700);
            --color-secondary: rgba(var(--color-brown-600-rgb), 0.12);
            --color-secondary-hover: rgba(var(--color-brown-600-rgb), 0.2);
            --color-border: rgba(var(--color-brown-600-rgb), 0.2);
            --color-btn-primary-text: var(--color-cream-50);
            --color-card-border: rgba(var(--color-brown-600-rgb), 0.12);
            --color-error: var(--color-red-500);
            --color-success: var(--color-teal-500);
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --color-gray-400-rgb: 119, 124, 124;
                --color-teal-300-rgb: 50, 184, 198;
                --color-gray-300-rgb: 167, 169, 169;
                --color-gray-200-rgb: 245, 245, 245;
                
                --color-background: var(--color-charcoal-700);
                --color-surface: var(--color-charcoal-800);
                --color-text: var(--color-gray-200);
                --color-text-secondary: rgba(var(--color-gray-300-rgb), 0.7);
                --color-primary: var(--color-teal-300);
                --color-primary-hover: var(--color-teal-400);
                --color-secondary: rgba(var(--color-gray-400-rgb), 0.15);
                --color-secondary-hover: rgba(var(--color-gray-400-rgb), 0.25);
                --color-border: rgba(var(--color-gray-400-rgb), 0.3);
                --color-btn-primary-text: var(--color-slate-900);
                --color-card-border: rgba(var(--color-gray-400-rgb), 0.2);
                --color-error: var(--color-red-400);
                --color-success: var(--color-teal-300);
            }
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background-color: var(--color-background);
            color: var(--color-text);
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background-color: var(--color-surface);
            padding: 20px;
            border-bottom: 1px solid var(--color-border);
            margin-bottom: 30px;
        }

        h1 {
            color: var(--color-primary);
            margin-bottom: 10px;
        }

        .nav-tabs {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 20px;
        }

        .nav-tabs button {
            padding: 12px 24px;
            border: 1px solid var(--color-border);
            background-color: var(--color-secondary);
            color: var(--color-text);
            cursor: pointer;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
        }

        .nav-tabs button:hover {
            background-color: var(--color-secondary-hover);
        }

        .nav-tabs button.active {
            background-color: var(--color-primary);
            color: var(--color-btn-primary-text);
            border-color: var(--color-primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .card {
            background-color: var(--color-surface);
            border: 1px solid var(--color-card-border);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
        }

        .card h2 {
            color: var(--color-primary);
            margin-bottom: 20px;
            font-size: 20px;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 16px;
        }

        label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            font-size: 14px;
            color: var(--color-text);
        }

        input, select {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--color-border);
            border-radius: 8px;
            font-size: 14px;
            background-color: var(--color-background);
            color: var(--color-text);
            transition: border-color 0.3s;
        }

        input:focus, select:focus {
            outline: 2px solid var(--color-primary);
            border-color: var(--color-primary);
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background-color: var(--color-primary);
            color: var(--color-btn-primary-text);
        }

        .btn-primary:hover {
            background-color: var(--color-primary-hover);
        }

        .btn-secondary {
            background-color: var(--color-secondary);
            color: var(--color-text);
        }

        .btn-secondary:hover {
            background-color: var(--color-secondary-hover);
        }

        .btn-danger {
            background-color: var(--color-error);
            color: var(--color-white);
        }

        .btn-danger:hover {
            opacity: 0.9;
        }

        .btn-group {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        thead {
            background-color: var(--color-secondary);
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--color-border);
        }

        th {
            font-weight: 600;
            font-size: 13px;
            text-transform: uppercase;
            color: var(--color-text-secondary);
        }

        tbody tr:hover {
            background-color: var(--color-secondary);
        }

        .actions {
            display: flex;
            gap: 8px;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 12px;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .summary-card {
            background-color: var(--color-surface);
            border: 1px solid var(--color-card-border);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
        }

        .summary-card h3 {
            font-size: 14px;
            color: var(--color-text-secondary);
            margin-bottom: 10px;
            font-weight: 500;
        }

        .summary-card .value {
            font-size: 28px;
            font-weight: 600;
            color: var(--color-primary);
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: var(--color-text-secondary);
        }

        .pdv-total {
            background-color: var(--color-primary);
            color: var(--color-btn-primary-text);
            padding: 20px;
            border-radius: 8px;
            text-align: right;
            margin-top: 20px;
        }

        .pdv-total h3 {
            font-size: 16px;
            margin-bottom: 8px;
        }

        .pdv-total .value {
            font-size: 32px;
            font-weight: 700;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .status-pendente {
            background-color: rgba(230, 129, 97, 0.2);
            color: var(--color-orange-500);
        }

        .status-pago {
            background-color: rgba(33, 128, 141, 0.2);
            color: var(--color-teal-500);
        }

        .status-vencido {
            background-color: rgba(192, 21, 47, 0.2);
            color: var(--color-red-500);
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>Sistema de Gest√£o Comercial</h1>
            <p style="color: var(--color-text-secondary);">PDV, Estoque e Controle Financeiro Integrados</p>
            <div class="nav-tabs">
                <button class="active" onclick="showTab('pdv')">PDV - Ponto de Venda</button>
                <button onclick="showTab('estoque')">Controle de Estoque</button>
                <button onclick="showTab('financeiro')">Controle Financeiro</button>
                <button onclick="showTab('relatorios')">Relat√≥rios</button>
                <button onclick="showTab('cadastros')">Cadastros</button>
                <button onclick="salvarDados()" style="margin-left: auto;">üíæ Backup</button>
                <button onclick="carregarDados()">üìÇ Restaurar</button>
            </div>
        </div>
    </header>

    <div class="container">
        <!-- PDV -->
        <div id="pdv" class="tab-content active">
            <div class="card">
                <h2>üõí Ponto de Venda (PDV)</h2>
                <div class="form-row">
                    <div class="form-group">
                        <label for="pdv-cliente">Cliente</label>
                        <select id="pdv-cliente">
                            <option value="">Selecione o cliente</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="pdv-produto">Produto</label>
                        <select id="pdv-produto" onchange="preencherDadosProduto()">
                            <option value="">Selecione o produto</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="pdv-descricao">Descri√ß√£o</label>
                        <input type="text" id="pdv-descricao" readonly>
                    </div>
                    <div class="form-group">
                        <label for="pdv-unidade">Unidade de Medida</label>
                        <input type="text" id="pdv-unidade" readonly>
                    </div>
                    <div class="form-group">
                        <label for="pdv-preco">Pre√ßo Unit√°rio (R$)</label>
                        <input type="number" id="pdv-preco" step="0.01" readonly>
                    </div>
                    <div class="form-group">
                        <label for="pdv-quantidade">Quantidade</label>
                        <input type="number" id="pdv-quantidade" step="0.01" min="0">
                    </div>
                </div>
                <div class="btn-group">
                    <button class="btn btn-primary" onclick="adicionarItemVenda()">Adicionar Item</button>
                    <button class="btn btn-secondary" onclick="limparFormPDV()">Limpar</button>
                </div>

                <table id="tabela-venda">
                    <thead>
                        <tr>
                            <th>Item</th>
                            <th>Descri√ß√£o</th>
                            <th>Unidade</th>
                            <th>Quantidade</th>
                            <th>Pre√ßo Unit.</th>
                            <th>Subtotal</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody id="itens-venda">
                        <tr>
                            <td colspan="7" class="empty-state">Nenhum item adicionado</td>
                        </tr>
                    </tbody>
                </table>

                <div class="pdv-total">
                    <h3>Total da Venda</h3>
                    <div class="value" id="total-venda">R$ 0,00</div>
                </div>

                <div class="btn-group">
                    <button class="btn btn-primary" onclick="finalizarVenda()">Finalizar Venda</button>
                    <button class="btn btn-secondary" onclick="imprimirVenda()">Imprimir Venda</button>
                    <button class="btn btn-secondary" onclick="salvarVenda()">Salvar Venda</button>
                    <button class="btn btn-secondary" onclick="exportarVenda()">Exportar (PDF)</button>
                    <button class="btn btn-danger" onclick="cancelarVenda()">Cancelar Venda</button>
                </div>
            </div>
        </div>

        <!-- ESTOQUE -->
        <div id="estoque" class="tab-content">
            <div class="summary-grid">
                <div class="summary-card">
                    <h3>Total de Produtos</h3>
                    <div class="value" id="total-produtos">0</div>
                </div>
                <div class="summary-card">
                    <h3>Produtos em Estoque</h3>
                    <div class="value" id="produtos-estoque">0</div>
                </div>
                <div class="summary-card">
                    <h3>Produtos Baixo Estoque</h3>
                    <div class="value" id="produtos-baixo">0</div>
                </div>
            </div>

            <div class="card">
                <h2>üì¶ Entrada de Estoque</h2>
                <div class="form-row">
                    <div class="form-group">
                        <label for="est-fornecedor">Fornecedor</label>
                        <select id="est-fornecedor">
                            <option value="">Selecione o fornecedor</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="est-produto">Produto</label>
                        <select id="est-produto" onchange="preencherDadosEstoque()">
                            <option value="">Selecione o produto</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="est-descricao">Descri√ß√£o</label>
                        <input type="text" id="est-descricao" readonly>
                    </div>
                    <div class="form-group">
                        <label for="est-unidade">Unidade de Medida</label>
                        <input type="text" id="est-unidade" readonly>
                    </div>
                    <div class="form-group">
                        <label for="est-quantidade">Quantidade</label>
                        <input type="number" id="est-quantidade" step="0.01" min="0">
                    </div>
                    <div class="form-group">
                        <label for="est-custo">Custo Unit√°rio (R$)</label>
                        <input type="number" id="est-custo" step="0.01" min="0">
                    </div>
                </div>
                <div class="btn-group">
                    <button class="btn btn-primary" onclick="registrarEntrada()">Registrar Entrada</button>
                    <button class="btn btn-secondary" onclick="limparFormEstoque()">Limpar</button>
                </div>
            </div>

            <div class="card">
                <h2>üìã Estoque Atual</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Item</th>
                            <th>Descri√ß√£o</th>
                            <th>Unidade</th>
                            <th>Quantidade</th>
                            <th>Custo M√©dio</th>
                            <th>Pre√ßo Venda</th>
                            <th>Valor Total</th>
                        </tr>
                    </thead>
                    <tbody id="tabela-estoque">
                        <tr>
                            <td colspan="7" class="empty-state">Nenhum produto em estoque</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- RELAT√ìRIOS -->
        <div id="relatorios" class="tab-content">
            <div class="card">
                <h2>üìä Relat√≥rios de Vendas</h2>
                <div class="form-row">
                    <div class="form-group">
                        <label for="rel-data-inicio">Data In√≠cio</label>
                        <input type="date" id="rel-data-inicio">
                    </div>
                    <div class="form-group">
                        <label for="rel-data-fim">Data Fim</label>
                        <input type="date" id="rel-data-fim">
                    </div>
                    <div class="form-group">
                        <label for="rel-cliente-filtro">Cliente (Opcional)</label>
                        <select id="rel-cliente-filtro">
                            <option value="">Todos os clientes</option>
                        </select>
                    </div>
                </div>
                <button class="btn btn-primary" onclick="gerarRelatorio()">Gerar Relat√≥rio</button>

                <div id="area-relatorio" style="display: none; margin-top: 30px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3 style="color: var(--color-primary);">Relat√≥rio Gerado</h3>
                        <div class="btn-group" style="margin: 0;">
                            <button class="btn btn-secondary btn-sm" onclick="imprimirRelatorio()">Imprimir</button>
                            <button class="btn btn-secondary btn-sm" onclick="exportarRelatorio()">Exportar (PDF)</button>
                        </div>
                    </div>

                    <div id="conteudo-relatorio" style="background-color: var(--color-surface); padding: 30px; border: 1px solid var(--color-border); border-radius: 8px;">
                        <div style="text-align: center; margin-bottom: 30px;">
                            <h2 style="color: var(--color-primary); margin-bottom: 5px;">Relat√≥rio de Vendas</h2>
                            <p id="periodo-relatorio" style="color: var(--color-text-secondary);"></p>
                        </div>

                        <div class="summary-grid" style="margin-bottom: 30px;">
                            <div class="summary-card">
                                <h3>Total de Vendas</h3>
                                <div class="value" id="rel-total-vendas">0</div>
                            </div>
                            <div class="summary-card">
                                <h3>Valor Total</h3>
                                <div class="value" id="rel-valor-total">R$ 0,00</div>
                            </div>
                            <div class="summary-card">
                                <h3>Ticket M√©dio</h3>
                                <div class="value" id="rel-ticket-medio">R$ 0,00</div>
                            </div>
                        </div>

                        <table id="tabela-relatorio">
                            <thead>
                                <tr>
                                    <th>Data</th>
                                    <th>Cliente</th>
                                    <th>Qtd. Itens</th>
                                    <th>Valor Total</th>
                                </tr>
                            </thead>
                            <tbody id="dados-relatorio">
                            </tbody>
                        </table>

                        <div style="margin-top: 60px; display: grid; grid-template-columns: 1fr 1fr; gap: 40px;">
                            <div style="text-align: center;">
                                <div style="border-top: 2px solid var(--color-border); padding-top: 10px; margin-top: 50px;">
                                    <p style="font-weight: 600; color: var(--color-text);">Assinatura do Respons√°vel pela Entrega</p>
                                </div>
                            </div>
                            <div style="text-align: center;">
                                <div style="border-top: 2px solid var(--color-border); padding-top: 10px; margin-top: 50px;">
                                    <p style="font-weight: 600; color: var(--color-text);">Assinatura do Respons√°vel pela Confer√™ncia e Recebimento</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- FINANCEIRO -->
        <div id="financeiro" class="tab-content">
            <div class="summary-grid">
                <div class="summary-card">
                    <h3>Saldo em Caixa</h3>
                    <div class="value" id="saldo-caixa">R$ 0,00</div>
                </div>
                <div class="summary-card">
                    <h3>Contas a Receber</h3>
                    <div class="value" id="total-receber">R$ 0,00</div>
                </div>
                <div class="summary-card">
                    <h3>Contas a Pagar</h3>
                    <div class="value" id="total-pagar">R$ 0,00</div>
                </div>
            </div>

            <div class="card">
                <h2>üí∞ Fluxo de Caixa</h2>
                <div class="form-row">
                    <div class="form-group">
                        <label for="fluxo-tipo">Tipo</label>
                        <select id="fluxo-tipo">
                            <option value="entrada">Entrada</option>
                            <option value="saida">Sa√≠da</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="fluxo-descricao">Descri√ß√£o</label>
                        <input type="text" id="fluxo-descricao" placeholder="Descri√ß√£o da movimenta√ß√£o">
                    </div>
                    <div class="form-group">
                        <label for="fluxo-valor">Valor (R$)</label>
                        <input type="number" id="fluxo-valor" step="0.01" min="0">
                    </div>
                    <div class="form-group">
                        <label for="fluxo-data">Data</label>
                        <input type="date" id="fluxo-data">
                    </div>
                </div>
                <button class="btn btn-primary" onclick="registrarFluxo()">Registrar Movimenta√ß√£o</button>

                <table style="margin-top: 30px;">
                    <thead>
                        <tr>
                            <th>Data</th>
                            <th>Tipo</th>
                            <th>Descri√ß√£o</th>
                            <th>Valor</th>
                            <th>Saldo</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody id="tabela-fluxo">
                        <tr>
                            <td colspan="6" class="empty-state">Nenhuma movimenta√ß√£o registrada</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="card">
                <h2>üì• Contas a Receber</h2>
                <div class="form-row">
                    <div class="form-group">
                        <label for="rec-cliente">Cliente</label>
                        <select id="rec-cliente">
                            <option value="">Selecione o cliente</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="rec-descricao">Descri√ß√£o</label>
                        <input type="text" id="rec-descricao" placeholder="Descri√ß√£o da conta">
                    </div>
                    <div class="form-group">
                        <label for="rec-valor">Valor (R$)</label>
                        <input type="number" id="rec-valor" step="0.01" min="0">
                    </div>
                    <div class="form-group">
                        <label for="rec-vencimento">Vencimento</label>
                        <input type="date" id="rec-vencimento">
                    </div>
                </div>
                <button class="btn btn-primary" onclick="adicionarContaReceber()">Adicionar Conta</button>

                <table style="margin-top: 30px;">
                    <thead>
                        <tr>
                            <th>Cliente</th>
                            <th>Descri√ß√£o</th>
                            <th>Valor</th>
                            <th>Vencimento</th>
                            <th>Status</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody id="tabela-receber">
                        <tr>
                            <td colspan="6" class="empty-state">Nenhuma conta a receber</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="card">
                <h2>üì§ Contas a Pagar</h2>
                <div class="form-row">
                    <div class="form-group">
                        <label for="pag-fornecedor">Fornecedor</label>
                        <select id="pag-fornecedor">
                            <option value="">Selecione o fornecedor</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="pag-descricao">Descri√ß√£o</label>
                        <input type="text" id="pag-descricao" placeholder="Descri√ß√£o da conta">
                    </div>
                    <div class="form-group">
                        <label for="pag-valor">Valor (R$)</label>
                        <input type="number" id="pag-valor" step="0.01" min="0">
                    </div>
                    <div class="form-group">
                        <label for="pag-vencimento">Vencimento</label>
                        <input type="date" id="pag-vencimento">
                    </div>
                </div>
                <button class="btn btn-primary" onclick="adicionarContaPagar()">Adicionar Conta</button>

                <table style="margin-top: 30px;">
                    <thead>
                        <tr>
                            <th>Fornecedor</th>
                            <th>Descri√ß√£o</th>
                            <th>Valor</th>
                            <th>Vencimento</th>
                            <th>Status</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody id="tabela-pagar">
                        <tr>
                            <td colspan="6" class="empty-state">Nenhuma conta a pagar</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- CADASTROS -->
        <div id="cadastros" class="tab-content">
            <div class="card">
                <h2>üë• Cadastro de Clientes</h2>
                <div class="form-row">
                    <div class="form-group">
                        <label for="cliente-nome">Nome</label>
                        <input type="text" id="cliente-nome" placeholder="Nome do cliente">
                    </div>
                    <div class="form-group">
                        <label for="cliente-cpf">CPF/CNPJ</label>
                        <input type="text" id="cliente-cpf" placeholder="000.000.000-00">
                    </div>
                    <div class="form-group">
                        <label for="cliente-telefone">Telefone</label>
                        <input type="text" id="cliente-telefone" placeholder="(00) 00000-0000">
                    </div>
                    <div class="form-group">
                        <label for="cliente-email">E-mail</label>
                        <input type="email" id="cliente-email" placeholder="email@exemplo.com">
                    </div>
                </div>
                <button class="btn btn-primary" onclick="cadastrarCliente()">Cadastrar Cliente</button>

                <table style="margin-top: 30px;">
                    <thead>
                        <tr>
                            <th>Nome</th>
                            <th>CPF/CNPJ</th>
                            <th>Telefone</th>
                            <th>E-mail</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody id="tabela-clientes">
                        <tr>
                            <td colspan="5" class="empty-state">Nenhum cliente cadastrado</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="card">
                <h2>üè¢ Cadastro de Fornecedores</h2>
                <div class="form-row">
                    <div class="form-group">
                        <label for="fornecedor-nome">Nome</label>
                        <input type="text" id="fornecedor-nome" placeholder="Nome do fornecedor">
                    </div>
                    <div class="form-group">
                        <label for="fornecedor-cnpj">CNPJ</label>
                        <input type="text" id="fornecedor-cnpj" placeholder="00.000.000/0000-00">
                    </div>
                    <div class="form-group">
                        <label for="fornecedor-telefone">Telefone</label>
                        <input type="text" id="fornecedor-telefone" placeholder="(00) 0000-0000">
                    </div>
                    <div class="form-group">
                        <label for="fornecedor-email">E-mail</label>
                        <input type="email" id="fornecedor-email" placeholder="email@exemplo.com">
                    </div>
                </div>
                <button class="btn btn-primary" onclick="cadastrarFornecedor()">Cadastrar Fornecedor</button>

                <table style="margin-top: 30px;">
                    <thead>
                        <tr>
                            <th>Nome</th>
                            <th>CNPJ</th>
                            <th>Telefone</th>
                            <th>E-mail</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody id="tabela-fornecedores">
                        <tr>
                            <td colspan="5" class="empty-state">Nenhum fornecedor cadastrado</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="card">
                <h2>üì¶ Cadastro de Produtos</h2>
                <div class="form-row">
                    <div class="form-group">
                        <label for="produto-item">C√≥digo/Item</label>
                        <input type="text" id="produto-item" placeholder="C√≥digo do produto">
                    </div>
                    <div class="form-group">
                        <label for="produto-descricao">Descri√ß√£o</label>
                        <input type="text" id="produto-descricao" placeholder="Descri√ß√£o do produto">
                    </div>
                    <div class="form-group">
                        <label for="produto-unidade">Unidade de Medida</label>
                        <select id="produto-unidade">
                            <option value="UN">UN - Unidade</option>
                            <option value="Kg">Kg - Quilograma</option>
                            <option value="g">g - Grama</option>
                            <option value="L">L - Litro</option>
                            <option value="mL">mL - Mililitro</option>
                            <option value="ma√ßo">Ma√ßo</option>
                            <option value="cx">Cx - Caixa</option>
                            <option value="pct">Pct - Pacote</option>
                            <option value="dz">Dz - D√∫zia</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="produto-preco">Pre√ßo de Venda (R$)</label>
                        <input type="number" id="produto-preco" step="0.01" min="0" placeholder="0,00">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="produto-estoque-min">Estoque M√≠nimo</label>
                        <input type="number" id="produto-estoque-min" step="0.01" min="0" placeholder="0">
                    </div>
                </div>
                <button class="btn btn-primary" onclick="cadastrarProduto()">Cadastrar Produto</button>

                <table style="margin-top: 30px;">
                    <thead>
                        <tr>
                            <th>C√≥digo</th>
                            <th>Descri√ß√£o</th>
                            <th>Unidade</th>
                            <th>Pre√ßo Venda</th>
                            <th>Estoque M√≠n.</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody id="tabela-produtos">
                        <tr>
                            <td colspan="6" class="empty-state">Nenhum produto cadastrado</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        let clientes = [];
        let fornecedores = [];
        let produtos = [];
        let estoque = [];
        let vendaAtual = [];
        let fluxoCaixa = [];
        let contasReceber = [];
        let contasPagar = [];
        let saldoCaixa = 0;
        let historicoVendas = [];

        function salvarDados() {
            const dados = {
                clientes,
                fornecedores,
                produtos,
                estoque,
                fluxoCaixa,
                contasReceber,
                contasPagar,
                saldoCaixa,
                historicoVendas,
                versao: '1.0'
            };
            const dadosJSON = JSON.stringify(dados);
            const dadosComprimidos = btoa(encodeURIComponent(dadosJSON));
            const blob = new Blob([dadosComprimidos], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `backup_gestao_${new Date().toISOString().split('T')[0]}.txt`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function carregarDados() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.txt';
            input.onchange = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const dadosComprimidos = event.target.result;
                        const dadosJSON = decodeURIComponent(atob(dadosComprimidos));
                        const dados = JSON.parse(dadosJSON);
                        
                        if (confirm('Deseja realmente carregar estes dados? Os dados atuais ser√£o substitu√≠dos.')) {
                            clientes = dados.clientes || [];
                            fornecedores = dados.fornecedores || [];
                            produtos = dados.produtos || [];
                            estoque = dados.estoque || [];
                            fluxoCaixa = dados.fluxoCaixa || [];
                            contasReceber = dados.contasReceber || [];
                            contasPagar = dados.contasPagar || [];
                            saldoCaixa = dados.saldoCaixa || 0;
                            historicoVendas = dados.historicoVendas || [];
                            
                            atualizarTodasTabelas();
                            alert('Dados carregados com sucesso!');
                        }
                    } catch (error) {
                        alert('Erro ao carregar o arquivo. Verifique se o arquivo √© v√°lido.');
                        console.error(error);
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }

        function atualizarTodasTabelas() {
            atualizarTabelaClientes();
            atualizarSelectsClientes();
            atualizarTabelaFornecedores();
            atualizarSelectsFornecedores();
            atualizarTabelaProdutos();
            atualizarSelectsProdutos();
            atualizarTabelaEstoque();
            atualizarTabelaFluxo();
            atualizarTabelaReceber();
            atualizarTabelaPagar();
            atualizarResumoFinanceiro();
            atualizarResumoEstoque();
        }

        function showTab(tabName) {
            const tabs = document.querySelectorAll('.tab-content');
            tabs.forEach(tab => tab.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');

            const buttons = document.querySelectorAll('.nav-tabs button');
            buttons.forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            if (tabName === 'estoque') {
                atualizarResumoEstoque();
            } else if (tabName === 'financeiro') {
                atualizarResumoFinanceiro();
            } else if (tabName === 'relatorios') {
                atualizarSelectRelatorio();
            }
        }

        function cadastrarCliente() {
            const nome = document.getElementById('cliente-nome').value;
            const cpf = document.getElementById('cliente-cpf').value;
            const telefone = document.getElementById('cliente-telefone').value;
            const email = document.getElementById('cliente-email').value;

            if (!nome) {
                alert('Por favor, preencha o nome do cliente.');
                return;
            }

            const cliente = {
                id: Date.now(),
                nome,
                cpf,
                telefone,
                email
            };

            clientes.push(cliente);
            atualizarTabelaClientes();
            atualizarSelectsClientes();
            limparFormCliente();
            alert('Cliente cadastrado com sucesso!');
        }

        function atualizarTabelaClientes() {
            const tbody = document.getElementById('tabela-clientes');
            if (clientes.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" class="empty-state">Nenhum cliente cadastrado</td></tr>';
                return;
            }

            tbody.innerHTML = clientes.map(c => `
                <tr>
                    <td>${c.nome}</td>
                    <td>${c.cpf}</td>
                    <td>${c.telefone}</td>
                    <td>${c.email}</td>
                    <td class="actions">
                        <button class="btn btn-danger btn-sm" onclick="excluirCliente(${c.id})">Excluir</button>
                    </td>
                </tr>
            `).join('');
        }

        function excluirCliente(id) {
            if (confirm('Deseja realmente excluir este cliente?')) {
                clientes = clientes.filter(c => c.id !== id);
                atualizarTabelaClientes();
                atualizarSelectsClientes();
            }
        }

        function limparFormCliente() {
            document.getElementById('cliente-nome').value = '';
            document.getElementById('cliente-cpf').value = '';
            document.getElementById('cliente-telefone').value = '';
            document.getElementById('cliente-email').value = '';
        }

        function atualizarSelectsClientes() {
            const selects = [
                document.getElementById('pdv-cliente'),
                document.getElementById('rec-cliente')
            ];

            selects.forEach(select => {
                const valorAtual = select.value;
                select.innerHTML = '<option value="">Selecione o cliente</option>' +
                    clientes.map(c => `<option value="${c.id}">${c.nome}</option>`).join('');
                select.value = valorAtual;
            });
        }

        function cadastrarFornecedor() {
            const nome = document.getElementById('fornecedor-nome').value;
            const cnpj = document.getElementById('fornecedor-cnpj').value;
            const telefone = document.getElementById('fornecedor-telefone').value;
            const email = document.getElementById('fornecedor-email').value;

            if (!nome) {
                alert('Por favor, preencha o nome do fornecedor.');
                return;
            }

            const fornecedor = {
                id: Date.now(),
                nome,
                cnpj,
                telefone,
                email
            };

            fornecedores.push(fornecedor);
            atualizarTabelaFornecedores();
            atualizarSelectsFornecedores();
            limparFormFornecedor();
            alert('Fornecedor cadastrado com sucesso!');
        }

        function atualizarTabelaFornecedores() {
            const tbody = document.getElementById('tabela-fornecedores');
            if (fornecedores.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" class="empty-state">Nenhum fornecedor cadastrado</td></tr>';
                return;
            }

            tbody.innerHTML = fornecedores.map(f => `
                <tr>
                    <td>${f.nome}</td>
                    <td>${f.cnpj}</td>
                    <td>${f.telefone}</td>
                    <td>${f.email}</td>
                    <td class="actions">
                        <button class="btn btn-danger btn-sm" onclick="excluirFornecedor(${f.id})">Excluir</button>
                    </td>
                </tr>
            `).join('');
        }

        function excluirFornecedor(id) {
            if (confirm('Deseja realmente excluir este fornecedor?')) {
                fornecedores = fornecedores.filter(f => f.id !== id);
                atualizarTabelaFornecedores();
                atualizarSelectsFornecedores();
            }
        }

        function limparFormFornecedor() {
            document.getElementById('fornecedor-nome').value = '';
            document.getElementById('fornecedor-cnpj').value = '';
            document.getElementById('fornecedor-telefone').value = '';
            document.getElementById('fornecedor-email').value = '';
        }

        function atualizarSelectsFornecedores() {
            const selects = [
                document.getElementById('est-fornecedor'),
                document.getElementById('pag-fornecedor')
            ];

            selects.forEach(select => {
                const valorAtual = select.value;
                select.innerHTML = '<option value="">Selecione o fornecedor</option>' +
                    fornecedores.map(f => `<option value="${f.id}">${f.nome}</option>`).join('');
                select.value = valorAtual;
            });
        }

        function cadastrarProduto() {
            const item = document.getElementById('produto-item').value;
            const descricao = document.getElementById('produto-descricao').value;
            const unidade = document.getElementById('produto-unidade').value;
            const preco = parseFloat(document.getElementById('produto-preco').value) || 0;
            const estoqueMin = parseFloat(document.getElementById('produto-estoque-min').value) || 0;

            if (!item || !descricao) {
                alert('Por favor, preencha o c√≥digo e a descri√ß√£o do produto.');
                return;
            }

            const produto = {
                id: Date.now(),
                item,
                descricao,
                unidade,
                preco,
                estoqueMin
            };

            produtos.push(produto);

            estoque.push({
                produtoId: produto.id,
                item: produto.item,
                descricao: produto.descricao,
                unidade: produto.unidade,
                quantidade: 0,
                custoMedio: 0,
                preco: produto.preco
            });

            atualizarTabelaProdutos();
            atualizarSelectsProdutos();
            atualizarTabelaEstoque();
            limparFormProduto();
            alert('Produto cadastrado com sucesso!');
        }

        function atualizarTabelaProdutos() {
            const tbody = document.getElementById('tabela-produtos');
            if (produtos.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" class="empty-state">Nenhum produto cadastrado</td></tr>';
                return;
            }

            tbody.innerHTML = produtos.map(p => `
                <tr>
                    <td>${p.item}</td>
                    <td>${p.descricao}</td>
                    <td>${p.unidade}</td>
                    <td>R$ ${p.preco.toFixed(2)}</td>
                    <td>${p.estoqueMin}</td>
                    <td class="actions">
                        <button class="btn btn-danger btn-sm" onclick="excluirProduto(${p.id})">Excluir</button>
                    </td>
                </tr>
            `).join('');
        }

        function excluirProduto(id) {
            if (confirm('Deseja realmente excluir este produto?')) {
                produtos = produtos.filter(p => p.id !== id);
                estoque = estoque.filter(e => e.produtoId !== id);
                atualizarTabelaProdutos();
                atualizarSelectsProdutos();
                atualizarTabelaEstoque();
            }
        }

        function limparFormProduto() {
            document.getElementById('produto-item').value = '';
            document.getElementById('produto-descricao').value = '';
            document.getElementById('produto-unidade').value = 'UN';
            document.getElementById('produto-preco').value = '';
            document.getElementById('produto-estoque-min').value = '';
        }

        function atualizarSelectsProdutos() {
            const selects = [
                document.getElementById('pdv-produto'),
                document.getElementById('est-produto')
            ];

            selects.forEach(select => {
                const valorAtual = select.value;
                select.innerHTML = '<option value="">Selecione o produto</option>' +
                    produtos.map(p => `<option value="${p.id}">${p.item} - ${p.descricao}</option>`).join('');
                select.value = valorAtual;
            });
        }

        function preencherDadosProduto() {
            const produtoId = parseInt(document.getElementById('pdv-produto').value);
            if (!produtoId) return;

            const produto = produtos.find(p => p.id === produtoId);
            const itemEstoque = estoque.find(e => e.produtoId === produtoId);

            if (produto) {
                document.getElementById('pdv-descricao').value = produto.descricao;
                document.getElementById('pdv-unidade').value = produto.unidade;
                document.getElementById('pdv-preco').value = produto.preco;
            }

            if (itemEstoque && itemEstoque.quantidade <= 0) {
                alert('Aten√ß√£o: Produto sem estoque dispon√≠vel!');
            }
        }

        function preencherDadosEstoque() {
            const produtoId = parseInt(document.getElementById('est-produto').value);
            if (!produtoId) return;

            const produto = produtos.find(p => p.id === produtoId);

            if (produto) {
                document.getElementById('est-descricao').value = produto.descricao;
                document.getElementById('est-unidade').value = produto.unidade;
            }
        }

        function adicionarItemVenda() {
            const clienteId = document.getElementById('pdv-cliente').value;
            const produtoId = parseInt(document.getElementById('pdv-produto').value);
            const quantidade = parseFloat(document.getElementById('pdv-quantidade').value);

            if (!clienteId) {
                alert('Por favor, selecione um cliente.');
                return;
            }

            if (!produtoId) {
                alert('Por favor, selecione um produto.');
                return;
            }

            if (!quantidade || quantidade <= 0) {
                alert('Por favor, informe uma quantidade v√°lida.');
                return;
            }

            const produto = produtos.find(p => p.id === produtoId);
            const itemEstoque = estoque.find(e => e.produtoId === produtoId);

            if (itemEstoque.quantidade < quantidade) {
                alert('Estoque insuficiente! Dispon√≠vel: ' + itemEstoque.quantidade);
                return;
            }

            const item = {
                produtoId: produto.id,
                item: produto.item,
                descricao: produto.descricao,
                unidade: produto.unidade,
                quantidade: quantidade,
                preco: produto.preco,
                subtotal: quantidade * produto.preco
            };

            vendaAtual.push(item);
            atualizarTabelaVenda();
            limparFormPDV();
        }

        function atualizarTabelaVenda() {
            const tbody = document.getElementById('itens-venda');
            if (vendaAtual.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" class="empty-state">Nenhum item adicionado</td></tr>';
                document.getElementById('total-venda').textContent = 'R$ 0,00';
                return;
            }

            tbody.innerHTML = vendaAtual.map((item, index) => `
                <tr>
                    <td>${item.item}</td>
                    <td>${item.descricao}</td>
                    <td>${item.unidade}</td>
                    <td>${item.quantidade.toFixed(2)}</td>
                    <td>R$ ${item.preco.toFixed(2)}</td>
                    <td>R$ ${item.subtotal.toFixed(2)}</td>
                    <td class="actions">
                        <button class="btn btn-danger btn-sm" onclick="removerItemVenda(${index})">Remover</button>
                    </td>
                </tr>
            `).join('');

            const total = vendaAtual.reduce((sum, item) => sum + item.subtotal, 0);
            document.getElementById('total-venda').textContent = `R$ ${total.toFixed(2)}`;
        }

        function removerItemVenda(index) {
            vendaAtual.splice(index, 1);
            atualizarTabelaVenda();
        }

        function limparFormPDV() {
            document.getElementById('pdv-produto').value = '';
            document.getElementById('pdv-descricao').value = '';
            document.getElementById('pdv-unidade').value = '';
            document.getElementById('pdv-preco').value = '';
            document.getElementById('pdv-quantidade').value = '';
        }

        function finalizarVenda() {
            const clienteId = document.getElementById('pdv-cliente').value;

            if (!clienteId) {
                alert('Por favor, selecione um cliente.');
                return;
            }

            if (vendaAtual.length === 0) {
                alert('Adicione pelo menos um item √† venda.');
                return;
            }

            const total = vendaAtual.reduce((sum, item) => sum + item.subtotal, 0);
            const cliente = clientes.find(c => c.id === parseInt(clienteId));

            vendaAtual.forEach(item => {
                const itemEstoque = estoque.find(e => e.produtoId === item.produtoId);
                itemEstoque.quantidade -= item.quantidade;
            });

            saldoCaixa += total;

            const hoje = new Date().toISOString().split('T')[0];
            fluxoCaixa.push({
                id: Date.now(),
                tipo: 'entrada',
                descricao: 'Venda - PDV',
                valor: total,
                data: hoje,
                saldo: saldoCaixa
            });

            historicoVendas.push({
                id: Date.now(),
                data: hoje,
                clienteId: parseInt(clienteId),
                clienteNome: cliente.nome,
                itens: [...vendaAtual],
                total: total
            });

            vendaAtual = [];
            atualizarTabelaVenda();
            atualizarTabelaEstoque();
            document.getElementById('pdv-cliente').value = '';

            alert(`Venda finalizada com sucesso!\nTotal: R$ ${total.toFixed(2)}`);
        }

        function imprimirVenda() {
            if (vendaAtual.length === 0) {
                alert('N√£o h√° itens na venda para imprimir.');
                return;
            }

            const clienteId = document.getElementById('pdv-cliente').value;
            const cliente = clientes.find(c => c.id === parseInt(clienteId));
            const clienteNome = cliente ? cliente.nome : 'Cliente n√£o selecionado';
            const total = vendaAtual.reduce((sum, item) => sum + item.subtotal, 0);
            const hoje = new Date().toLocaleDateString('pt-BR');

            let conteudo = `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Venda - PDV</title>
                    <style>
                        body { font-family: Arial, sans-serif; padding: 20px; }
                        h1 { color: #21808d; text-align: center; }
                        table { width: 100%; border-collapse: collapse; margin: 20px 0; }
                        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
                        th { background-color: #f5f5f5; }
                        .total { font-size: 24px; font-weight: bold; text-align: right; margin-top: 20px; }
                        .info { margin-bottom: 20px; }
                    </style>
                </head>
                <body>
                    <h1>Comprovante de Venda</h1>
                    <div class="info">
                        <p><strong>Cliente:</strong> ${clienteNome}</p>
                        <p><strong>Data:</strong> ${hoje}</p>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Item</th>
                                <th>Descri√ß√£o</th>
                                <th>Unidade</th>
                                <th>Quantidade</th>
                                <th>Pre√ßo Unit.</th>
                                <th>Subtotal</th>
                            </tr>
                        </thead>
                        <tbody>
            `;

            vendaAtual.forEach(item => {
                conteudo += `
                    <tr>
                        <td>${item.item}</td>
                        <td>${item.descricao}</td>
                        <td>${item.unidade}</td>
                        <td>${item.quantidade.toFixed(2)}</td>
                        <td>R$ ${item.preco.toFixed(2)}</td>
                        <td>R$ ${item.subtotal.toFixed(2)}</td>
                    </tr>
                `;
            });

            conteudo += `
                        </tbody>
                    </table>
                    <div class="total">Total: R$ ${total.toFixed(2)}</div>
                </body>
                </html>
            `;

            const janela = window.open('', '_blank');
            janela.document.write(conteudo);
            janela.document.close();
            janela.print();
        }

        function salvarVenda() {
            if (vendaAtual.length === 0) {
                alert('N√£o h√° itens na venda para salvar.');
                return;
            }

            const clienteId = document.getElementById('pdv-cliente').value;
            const cliente = clientes.find(c => c.id === parseInt(clienteId));
            const clienteNome = cliente ? cliente.nome : 'Cliente n√£o selecionado';
            const total = vendaAtual.reduce((sum, item) => sum + item.subtotal, 0);
            const hoje = new Date().toLocaleDateString('pt-BR');

            let conteudo = `COMPROVANTE DE VENDA\n`;
            conteudo += `==========================================\n\n`;
            conteudo += `Cliente: ${clienteNome}\n`;
            conteudo += `Data: ${hoje}\n\n`;
            conteudo += `ITENS:\n`;
            conteudo += `------------------------------------------\n`;

            vendaAtual.forEach(item => {
                conteudo += `${item.item} - ${item.descricao}\n`;
                conteudo += `  Qtd: ${item.quantidade.toFixed(2)} ${item.unidade}\n`;
                conteudo += `  Pre√ßo: R$ ${item.preco.toFixed(2)}\n`;
                conteudo += `  Subtotal: R$ ${item.subtotal.toFixed(2)}\n\n`;
            });

            conteudo += `------------------------------------------\n`;
            conteudo += `TOTAL: R$ ${total.toFixed(2)}\n`;

            const blob = new Blob([conteudo], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `venda_${Date.now()}.txt`;
            a.click();
            URL.revokeObjectURL(url);

            alert('Venda salva com sucesso!');
        }

        function exportarVenda() {
            if (vendaAtual.length === 0) {
                alert('N√£o h√° itens na venda para exportar.');
                return;
            }

            const clienteId = document.getElementById('pdv-cliente').value;
            const cliente = clientes.find(c => c.id === parseInt(clienteId));
            const clienteNome = cliente ? cliente.nome : 'Cliente n√£o selecionado';
            const total = vendaAtual.reduce((sum, item) => sum + item.subtotal, 0);
            const hoje = new Date().toLocaleDateString('pt-BR');

            let conteudo = `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Venda - PDV</title>
                    <style>
                        body { font-family: Arial, sans-serif; padding: 20px; }
                        h1 { color: #21808d; text-align: center; }
                        table { width: 100%; border-collapse: collapse; margin: 20px 0; }
                        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
                        th { background-color: #f5f5f5; }
                        .total { font-size: 24px; font-weight: bold; text-align: right; margin-top: 20px; }
                        .info { margin-bottom: 20px; }
                    </style>
                </head>
                <body>
                    <h1>Comprovante de Venda</h1>
                    <div class="info">
                        <p><strong>Cliente:</strong> ${clienteNome}</p>
                        <p><strong>Data:</strong> ${hoje}</p>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Item</th>
                                <th>Descri√ß√£o</th>
                                <th>Unidade</th>
                                <th>Quantidade</th>
                                <th>Pre√ßo Unit.</th>
                                <th>Subtotal</th>
                            </tr>
                        </thead>
                        <tbody>
            `;

            vendaAtual.forEach(item => {
                conteudo += `
                    <tr>
                        <td>${item.item}</td>
                        <td>${item.descricao}</td>
                        <td>${item.unidade}</td>
                        <td>${item.quantidade.toFixed(2)}</td>
                        <td>R$ ${item.preco.toFixed(2)}</td>
                        <td>R$ ${item.subtotal.toFixed(2)}</td>
                    </tr>
                `;
            });

            conteudo += `
                        </tbody>
                    </table>
                    <div class="total">Total: R$ ${total.toFixed(2)}</div>
                </body>
                </html>
            `;

            const janela = window.open('', '_blank');
            janela.document.write(conteudo);
            janela.document.close();
            janela.print();
        }

        function atualizarSelectRelatorio() {
            const select = document.getElementById('rel-cliente-filtro');
            select.innerHTML = '<option value="">Todos os clientes</option>' +
                clientes.map(c => `<option value="${c.id}">${c.nome}</option>`).join('');
        }

        function gerarRelatorio() {
            const dataInicio = document.getElementById('rel-data-inicio').value;
            const dataFim = document.getElementById('rel-data-fim').value;
            const clienteFiltro = document.getElementById('rel-cliente-filtro').value;

            if (!dataInicio || !dataFim) {
                alert('Por favor, informe o per√≠odo do relat√≥rio.');
                return;
            }

            const inicio = new Date(dataInicio + 'T00:00');
            const fim = new Date(dataFim + 'T23:59');

            let vendasFiltradas = historicoVendas.filter(v => {
                const dataVenda = new Date(v.data + 'T00:00');
                return dataVenda >= inicio && dataVenda <= fim;
            });

            if (clienteFiltro) {
                vendasFiltradas = vendasFiltradas.filter(v => v.clienteId === parseInt(clienteFiltro));
            }

            const totalVendas = vendasFiltradas.length;
            const valorTotal = vendasFiltradas.reduce((sum, v) => sum + v.total, 0);
            const ticketMedio = totalVendas > 0 ? valorTotal / totalVendas : 0;

            document.getElementById('rel-total-vendas').textContent = totalVendas;
            document.getElementById('rel-valor-total').textContent = `R$ ${valorTotal.toFixed(2)}`;
            document.getElementById('rel-ticket-medio').textContent = `R$ ${ticketMedio.toFixed(2)}`;

            const inicioFormatado = new Date(dataInicio + 'T00:00').toLocaleDateString('pt-BR');
            const fimFormatado = new Date(dataFim + 'T00:00').toLocaleDateString('pt-BR');
            document.getElementById('periodo-relatorio').textContent = `Per√≠odo: ${inicioFormatado} a ${fimFormatado}`;

            const tbody = document.getElementById('dados-relatorio');
            if (vendasFiltradas.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" class="empty-state">Nenhuma venda encontrada no per√≠odo</td></tr>';
            } else {
                tbody.innerHTML = vendasFiltradas.map(v => {
                    const dataVenda = new Date(v.data + 'T00:00').toLocaleDateString('pt-BR');
                    return `
                        <tr>
                            <td>${dataVenda}</td>
                            <td>${v.clienteNome}</td>
                            <td>${v.itens.length}</td>
                            <td>R$ ${v.total.toFixed(2)}</td>
                        </tr>
                    `;
                }).join('');
            }

            document.getElementById('area-relatorio').style.display = 'block';
        }

        function imprimirRelatorio() {
            const conteudo = document.getElementById('conteudo-relatorio').innerHTML;
            const janela = window.open('', '_blank');
            janela.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Relat√≥rio de Vendas</title>
                    <style>
                        body { font-family: Arial, sans-serif; padding: 20px; }
                        h2, h3 { color: #21808d; }
                        table { width: 100%; border-collapse: collapse; margin: 20px 0; }
                        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
                        th { background-color: #f5f5f5; font-weight: 600; }
                        .summary-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin: 30px 0; }
                        .summary-card { border: 1px solid #ddd; padding: 20px; border-radius: 8px; text-align: center; }
                        .summary-card h3 { font-size: 14px; color: #626c71; margin-bottom: 10px; }
                        .summary-card .value { font-size: 28px; font-weight: 600; color: #21808d; }
                        @media print {
                            body { padding: 10px; }
                        }
                    </style>
                </head>
                <body>
                    ${conteudo}
                </body>
                </html>
            `);
            janela.document.close();
            janela.print();
        }

        function exportarRelatorio() {
            imprimirRelatorio();
        }

        function cancelarVenda() {
            if (vendaAtual.length === 0) {
                alert('N√£o h√° venda em andamento.');
                return;
            }

            if (confirm('Deseja realmente cancelar a venda atual?')) {
                vendaAtual = [];
                atualizarTabelaVenda();
                document.getElementById('pdv-cliente').value = '';
            }
        }

        function registrarEntrada() {
            const fornecedorId = document.getElementById('est-fornecedor').value;
            const produtoId = parseInt(document.getElementById('est-produto').value);
            const quantidade = parseFloat(document.getElementById('est-quantidade').value);
            const custo = parseFloat(document.getElementById('est-custo').value);

            if (!fornecedorId) {
                alert('Por favor, selecione um fornecedor.');
                return;
            }

            if (!produtoId) {
                alert('Por favor, selecione um produto.');
                return;
            }

            if (!quantidade || quantidade <= 0) {
                alert('Por favor, informe uma quantidade v√°lida.');
                return;
            }

            if (!custo || custo <= 0) {
                alert('Por favor, informe um custo v√°lido.');
                return;
            }

            const itemEstoque = estoque.find(e => e.produtoId === produtoId);
            const quantidadeAnterior = itemEstoque.quantidade;
            const custoTotal = itemEstoque.custoMedio * quantidadeAnterior;
            const novoTotal = custoTotal + (custo * quantidade);
            const novaQuantidade = quantidadeAnterior + quantidade;

            itemEstoque.quantidade = novaQuantidade;
            itemEstoque.custoMedio = novoTotal / novaQuantidade;

            atualizarTabelaEstoque();
            limparFormEstoque();
            alert('Entrada registrada com sucesso!');
        }

        function limparFormEstoque() {
            document.getElementById('est-fornecedor').value = '';
            document.getElementById('est-produto').value = '';
            document.getElementById('est-descricao').value = '';
            document.getElementById('est-unidade').value = '';
            document.getElementById('est-quantidade').value = '';
            document.getElementById('est-custo').value = '';
        }

        function atualizarTabelaEstoque() {
            const tbody = document.getElementById('tabela-estoque');
            if (estoque.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" class="empty-state">Nenhum produto em estoque</td></tr>';
                return;
            }

            tbody.innerHTML = estoque.map(e => {
                const valorTotal = e.quantidade * e.custoMedio;
                return `
                    <tr>
                        <td>${e.item}</td>
                        <td>${e.descricao}</td>
                        <td>${e.unidade}</td>
                        <td>${e.quantidade.toFixed(2)}</td>
                        <td>R$ ${e.custoMedio.toFixed(2)}</td>
                        <td>R$ ${e.preco.toFixed(2)}</td>
                        <td>R$ ${valorTotal.toFixed(2)}</td>
                    </tr>
                `;
            }).join('');
        }

        function atualizarResumoEstoque() {
            const totalProdutos = produtos.length;
            const produtosEmEstoque = estoque.filter(e => e.quantidade > 0).length;
            const produtosBaixo = estoque.filter(e => {
                const produto = produtos.find(p => p.id === e.produtoId);
                return produto && e.quantidade <= produto.estoqueMin && produto.estoqueMin > 0;
            }).length;

            document.getElementById('total-produtos').textContent = totalProdutos;
            document.getElementById('produtos-estoque').textContent = produtosEmEstoque;
            document.getElementById('produtos-baixo').textContent = produtosBaixo;
        }

        function registrarFluxo() {
            const tipo = document.getElementById('fluxo-tipo').value;
            const descricao = document.getElementById('fluxo-descricao').value;
            const valor = parseFloat(document.getElementById('fluxo-valor').value);
            const data = document.getElementById('fluxo-data').value;

            if (!descricao) {
                alert('Por favor, informe a descri√ß√£o.');
                return;
            }

            if (!valor || valor <= 0) {
                alert('Por favor, informe um valor v√°lido.');
                return;
            }

            if (!data) {
                alert('Por favor, informe a data.');
                return;
            }

            if (tipo === 'entrada') {
                saldoCaixa += valor;
            } else {
                saldoCaixa -= valor;
            }

            const movimento = {
                id: Date.now(),
                tipo,
                descricao,
                valor,
                data,
                saldo: saldoCaixa
            };

            fluxoCaixa.push(movimento);
            atualizarTabelaFluxo();
            limparFormFluxo();
            atualizarResumoFinanceiro();
            alert('Movimenta√ß√£o registrada com sucesso!');
        }

        function limparFormFluxo() {
            document.getElementById('fluxo-tipo').value = 'entrada';
            document.getElementById('fluxo-descricao').value = '';
            document.getElementById('fluxo-valor').value = '';
            document.getElementById('fluxo-data').value = '';
        }

        function atualizarTabelaFluxo() {
            const tbody = document.getElementById('tabela-fluxo');
            if (fluxoCaixa.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" class="empty-state">Nenhuma movimenta√ß√£o registrada</td></tr>';
                return;
            }

            const fluxoOrdenado = [...fluxoCaixa].sort((a, b) => new Date(b.data) - new Date(a.data));

            tbody.innerHTML = fluxoOrdenado.map(f => `
                <tr>
                    <td>${new Date(f.data + 'T00:00').toLocaleDateString('pt-BR')}</td>
                    <td><span class="status-badge status-${f.tipo === 'entrada' ? 'pago' : 'vencido'}">${f.tipo === 'entrada' ? 'Entrada' : 'Sa√≠da'}</span></td>
                    <td>${f.descricao}</td>
                    <td style="color: ${f.tipo === 'entrada' ? 'var(--color-success)' : 'var(--color-error)'}">${f.tipo === 'entrada' ? '+' : '-'} R$ ${f.valor.toFixed(2)}</td>
                    <td>R$ ${f.saldo.toFixed(2)}</td>
                    <td class="actions">
                        <button class="btn btn-danger btn-sm" onclick="excluirFluxo(${f.id})">Excluir</button>
                    </td>
                </tr>
            `).join('');
        }

        function excluirFluxo(id) {
            if (confirm('Deseja realmente excluir esta movimenta√ß√£o?')) {
                const movimento = fluxoCaixa.find(f => f.id === id);
                if (movimento.tipo === 'entrada') {
                    saldoCaixa -= movimento.valor;
                } else {
                    saldoCaixa += movimento.valor;
                }

                fluxoCaixa = fluxoCaixa.filter(f => f.id !== id);
                atualizarTabelaFluxo();
                atualizarResumoFinanceiro();
            }
        }

        function adicionarContaReceber() {
            const clienteId = document.getElementById('rec-cliente').value;
            const descricao = document.getElementById('rec-descricao').value;
            const valor = parseFloat(document.getElementById('rec-valor').value);
            const vencimento = document.getElementById('rec-vencimento').value;

            if (!clienteId) {
                alert('Por favor, selecione um cliente.');
                return;
            }

            if (!descricao) {
                alert('Por favor, informe a descri√ß√£o.');
                return;
            }

            if (!valor || valor <= 0) {
                alert('Por favor, informe um valor v√°lido.');
                return;
            }

            if (!vencimento) {
                alert('Por favor, informe a data de vencimento.');
                return;
            }

            const cliente = clientes.find(c => c.id === parseInt(clienteId));

            const conta = {
                id: Date.now(),
                clienteId: parseInt(clienteId),
                clienteNome: cliente.nome,
                descricao,
                valor,
                vencimento,
                status: 'pendente'
            };

            contasReceber.push(conta);
            atualizarTabelaReceber();
            limparFormReceber();
            atualizarResumoFinanceiro();
            alert('Conta a receber adicionada com sucesso!');
        }

        function limparFormReceber() {
            document.getElementById('rec-cliente').value = '';
            document.getElementById('rec-descricao').value = '';
            document.getElementById('rec-valor').value = '';
            document.getElementById('rec-vencimento').value = '';
        }

        function atualizarTabelaReceber() {
            const tbody = document.getElementById('tabela-receber');
            if (contasReceber.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" class="empty-state">Nenhuma conta a receber</td></tr>';
                return;
            }

            const hoje = new Date();
            hoje.setHours(0, 0, 0, 0);

            tbody.innerHTML = contasReceber.map(c => {
                const dataVenc = new Date(c.vencimento + 'T00:00');
                let statusClasse = 'status-pendente';
                let statusTexto = 'Pendente';

                if (c.status === 'pago') {
                    statusClasse = 'status-pago';
                    statusTexto = 'Pago';
                } else if (dataVenc < hoje) {
                    statusClasse = 'status-vencido';
                    statusTexto = 'Vencido';
                }

                return `
                    <tr>
                        <td>${c.clienteNome}</td>
                        <td>${c.descricao}</td>
                        <td>R$ ${c.valor.toFixed(2)}</td>
                        <td>${dataVenc.toLocaleDateString('pt-BR')}</td>
                        <td><span class="status-badge ${statusClasse}">${statusTexto}</span></td>
                        <td class="actions">
                            ${c.status !== 'pago' ? `<button class="btn btn-primary btn-sm" onclick="receberConta(${c.id})">Receber</button>` : ''}
                            <button class="btn btn-danger btn-sm" onclick="excluirReceber(${c.id})">Excluir</button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function receberConta(id) {
            const conta = contasReceber.find(c => c.id === id);
            if (!conta) return;

            conta.status = 'pago';

            saldoCaixa += conta.valor;

            const hoje = new Date().toISOString().split('T')[0];
            fluxoCaixa.push({
                id: Date.now(),
                tipo: 'entrada',
                descricao: `Recebimento - ${conta.descricao}`,
                valor: conta.valor,
                data: hoje,
                saldo: saldoCaixa
            });

            atualizarTabelaReceber();
            atualizarResumoFinanceiro();
            alert('Conta recebida com sucesso!');
        }

        function excluirReceber(id) {
            if (confirm('Deseja realmente excluir esta conta?')) {
                contasReceber = contasReceber.filter(c => c.id !== id);
                atualizarTabelaReceber();
                atualizarResumoFinanceiro();
            }
        }

        function adicionarContaPagar() {
            const fornecedorId = document.getElementById('pag-fornecedor').value;
            const descricao = document.getElementById('pag-descricao').value;
            const valor = parseFloat(document.getElementById('pag-valor').value);
            const vencimento = document.getElementById('pag-vencimento').value;

            if (!fornecedorId) {
                alert('Por favor, selecione um fornecedor.');
                return;
            }

            if (!descricao) {
                alert('Por favor, informe a descri√ß√£o.');
                return;
            }

            if (!valor || valor <= 0) {
                alert('Por favor, informe um valor v√°lido.');
                return;
            }

            if (!vencimento) {
                alert('Por favor, informe a data de vencimento.');
                return;
            }

            const fornecedor = fornecedores.find(f => f.id === parseInt(fornecedorId));

            const conta = {
                id: Date.now(),
                fornecedorId: parseInt(fornecedorId),
                fornecedorNome: fornecedor.nome,
                descricao,
                valor,
                vencimento,
                status: 'pendente'
            };

            contasPagar.push(conta);
            atualizarTabelaPagar();
            limparFormPagar();
            atualizarResumoFinanceiro();
            alert('Conta a pagar adicionada com sucesso!');
        }

        function limparFormPagar() {
            document.getElementById('pag-fornecedor').value = '';
            document.getElementById('pag-descricao').value = '';
            document.getElementById('pag-valor').value = '';
            document.getElementById('pag-vencimento').value = '';
        }

        function atualizarTabelaPagar() {
            const tbody = document.getElementById('tabela-pagar');
            if (contasPagar.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" class="empty-state">Nenhuma conta a pagar</td></tr>';
                return;
            }

            const hoje = new Date();
            hoje.setHours(0, 0, 0, 0);

            tbody.innerHTML = contasPagar.map(c => {
                const dataVenc = new Date(c.vencimento + 'T00:00');
                let statusClasse = 'status-pendente';
                let statusTexto = 'Pendente';

                if (c.status === 'pago') {
                    statusClasse = 'status-pago';
                    statusTexto = 'Pago';
                } else if (dataVenc < hoje) {
                    statusClasse = 'status-vencido';
                    statusTexto = 'Vencido';
                }

                return `
                    <tr>
                        <td>${c.fornecedorNome}</td>
                        <td>${c.descricao}</td>
                        <td>R$ ${c.valor.toFixed(2)}</td>
                        <td>${dataVenc.toLocaleDateString('pt-BR')}</td>
                        <td><span class="status-badge ${statusClasse}">${statusTexto}</span></td>
                        <td class="actions">
                            ${c.status !== 'pago' ? `<button class="btn btn-primary btn-sm" onclick="pagarConta(${c.id})">Pagar</button>` : ''}
                            <button class="btn btn-danger btn-sm" onclick="excluirPagar(${c.id})">Excluir</button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function pagarConta(id) {
            const conta = contasPagar.find(c => c.id === id);
            if (!conta) return;

            if (saldoCaixa < conta.valor) {
                if (!confirm(`Saldo insuficiente em caixa (R$ ${saldoCaixa.toFixed(2)}). Deseja pagar mesmo assim?`)) {
                    return;
                }
            }

            conta.status = 'pago';

            saldoCaixa -= conta.valor;

            const hoje = new Date().toISOString().split('T')[0];
            fluxoCaixa.push({
                id: Date.now(),
                tipo: 'saida',
                descricao: `Pagamento - ${conta.descricao}`,
                valor: conta.valor,
                data: hoje,
                saldo: saldoCaixa
            });

            atualizarTabelaPagar();
            atualizarResumoFinanceiro();
            alert('Conta paga com sucesso!');
        }

        function excluirPagar(id) {
            if (confirm('Deseja realmente excluir esta conta?')) {
                contasPagar = contasPagar.filter(c => c.id !== id);
                atualizarTabelaPagar();
                atualizarResumoFinanceiro();
            }
        }

        function atualizarResumoFinanceiro() {
            document.getElementById('saldo-caixa').textContent = `R$ ${saldoCaixa.toFixed(2)}`;

            const totalReceber = contasReceber
                .filter(c => c.status === 'pendente')
                .reduce((sum, c) => sum + c.valor, 0);
            document.getElementById('total-receber').textContent = `R$ ${totalReceber.toFixed(2)}`;

            const totalPagar = contasPagar
                .filter(c => c.status === 'pendente')
                .reduce((sum, c) => sum + c.valor, 0);
            document.getElementById('total-pagar').textContent = `R$ ${totalPagar.toFixed(2)}`;
        }

        document.getElementById('fluxo-data').valueAsDate = new Date();
        document.getElementById('rec-vencimento').valueAsDate = new Date();
        document.getElementById('pag-vencimento').valueAsDate = new Date();
        document.getElementById('rel-data-inicio').valueAsDate = new Date();
        document.getElementById('rel-data-fim').valueAsDate = new Date();
    </script>
</body>
</html>
